#!/bin/bash
# Nuclear cleanup: delete all user data and models
echo "ðŸ’£ NUKE: Deleting all user data and models..."
shopt -s nullglob dotglob

# Helper: best-effort deletion
wipe() {
  for p in "$@"; do
    [ -e "$p" ] && rm -rf "$p" 2>/dev/null || true
  done
}

# PHASE 1: Histories & Temp (instant)
echo "  â€¢ Clearing histories and temp files..."
wipe /root/.bash_history /root/.python_history /tmp/* /var/tmp/* /workspace/ComfyUI/temp/*

# PHASE 2: User Data (fast)
echo "  â€¢ Removing user workflows and outputs..."
wipe /workspace/ComfyUI/user/* /workspace/ComfyUI/input/* /workspace/ComfyUI/output/* \
     /workspace/ComfyUI/logs/* /workspace/ComfyUI/custom_nodes/*/cache* \
     /workspace/ComfyUI/custom_nodes/*/history* /workspace/ComfyUI/custom_nodes/*/*.db

# PHASE 3: Caches (medium - includes custom nodes, pip, Python bytecode via .cache/.local)
echo "  â€¢ Purging caches and application data..."
wipe /root/.cache/* /root/.local/share/* /root/.config/* /workspace/.cache/*

# PHASE 4: Models (slow - ~20-30s)
echo "  â€¢ Deleting models..."
wipe /workspace/ComfyUI/models/*

echo "âœ… Nuclear cleanup complete"
